<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style>
        #myCanvas {
            border: 1px solid black;
            background-color: lightgrey;
        }
    </style>
</head>

<body>

<canvas id="myCanvas" width="680px" height="500px">
</canvas>
<div>Time Remaining <span id="time"></span></div>
<div>Score: <span id="scoreBoard"></span></div>
<button onClick="gameStartfunction ()">Start</button>
<script>
    var canvas = document.getElementById("myCanvas");
    canvas.onmousedown = myDown;
    canvas.onmousemove = myMove;
    canvas.onmouseup = myUp;

    var ctx = canvas.getContext("2d");
    var diff, gInterval;

    scoreBoard = new ScoreBoard();
    scoreBoard.update();
    recPiece = new Rectangle();
    recPiece.update(25, 35);

    function Rectangle() {
        var width = 60;
        var height = 60;
        var color = "red";
        var score = 0;
        ctx.fillStyle = color;
        var _x = -1, _y = -1;
        var draggable2 = false;
        this.update = function (x, y) {
            if (draggable2 || _x < 0) {
                if (_x > 0) {
                    ctx.clearRect(_x, _y, width, height);
                }
                ctx.fillRect(x, y, width, height);
                _x = x;
                _y = y;
            }
        };


        this.onMouseDown = function (x, y) {
            if (x < _x + width && x > _x && y < _y + height && y > _y) {
                draggable2 = true;
            }

        }
        this.onScore = function () {
            draggable2 = false;
            console.log("onScore ", draggable2)
        }
    }

    function ScoreBoard() {
        var x = 330;
        var y = 400;
        var rw = 60;
        var rh = 30;
        var h = 70;
        var score = 0;

        this.update = function () {
            ctx.beginPath();
            ctx.ellipse(x, y, rw, rh, 0, 0, 2 * Math.PI);
            ctx.moveTo((x - rw), y);
            ctx.lineTo((x - rw), (y + h));
            ctx.lineTo((x + rw), (y + h));
            ctx.lineTo((x + rw), y);
            ctx.lineWidth = 4;
            ctx.strokeStyle = "orange";
            ctx.fillText("Rectangle", x - 20, y + 55);
            ctx.stroke();
        }

        this.getScore = function (sx, sy) {

            if (this.isOnScoreBoard(sx, sy) ) {
                score += 1;
                updatScore(score);
                recPiece.onScore();
                repaint();
            }
        }

        this.isOnScoreBoard = function (sx, sy) {
            return sx < x + 40 && sx > x - 40 && sy < y + 40 && sy > y - 40;
        }

        function repaint () {
           recPiece = new Rectangle();
           recPiece.update(25, 35);
        }
    }


    function myMove(e) {
        var mx = e.pageX - canvas.offsetLeft;
        var my = e.pageY - canvas.offsetTop;
        recPiece.update(mx, my);
    }

    function myDown(e) {
        e.preventDefault();
        var newX = e.pageX - canvas.offsetLeft;
        var newY = e.pageY - canvas.offsetTop;

        if (!scoreBoard.isOnScoreBoard(newX, newY)) {
            recPiece.onMouseDown(newX, newY);
        }


    }

    function updatScore(score) {
        document.getElementById("scoreBoard").innerHTML = score;

    }

    function myUp(e) {

        var cx = e.pageX - canvas.offsetLeft;
        var cy = e.pageY - canvas.offsetTop;
        scoreBoard.getScore(cx, cy);

    }




    function startTimer(duration, display) {
        var start = Date.now(),
            minutes,
            seconds;

        function timer() {
            diff = duration - (((Date.now() - start) / 1000) | 0);
            minutes = parseInt(diff / 60);
            seconds = (diff % 60) | 0;

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            display.textContent = minutes + ":" + seconds;
            if (diff <= 0) {
                clearInterval(t);
                clearInterval(gInterval);
            }

        }


        timer();
        var t = setInterval(timer, 1000);
    }


    function gameStartfunction() {
        var oneMinutes = 10;
        var display = document.querySelector('#time');
        startTimer(oneMinutes, display);
    }

</script>
</body>
</html>